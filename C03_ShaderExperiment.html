<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>C03_ShaderExperiment - Chris Woodall - Generative Art Studio</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><meta content="The goal here was to get the basic shaders to work, in order to do this I had to learn a little about shaders (which I found semi non-intuitive and the documentation is poor at best)." name="description" /><link href="https://cwoodall.com/C03_ShaderExperiment.html" rel="canonical" /><meta content="C03_ShaderExperiment" property="og:title" /><meta content="Chris Woodall - Generative Art Studio" property="og:site_name" /><meta content="article" property="og:type" /><meta content="https://cwoodall.com/static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-00.56.46.png" property="og:image" /><meta content="C03_ShaderExperiment" property="neuron:zettel-id" /><meta content="C03_ShaderExperiment" property="neuron:zettel-slug" /><meta content="root/sketches" property="neuron:zettel-tag" /><script type="application/ld+json">[{"@context":"https://schema.org","itemListElement":[{"name":"sketches/","item":"https://cwoodall.com/sketches.html","@type":"ListItem","position":1}],"@type":"BreadcrumbList"}]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(219,40,40,0.1)}body nav.bottomPane{background-color:rgba(219,40,40,2.0e-2)}body div#footnotes{border-top-color:#db2828}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#db2828;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(219,40,40,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" rel="stylesheet" /><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/autoloader/prism-autoloader.min.js"></script><!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><nav class="flipped tree deemphasized" id="zettel-uptree" style="transform-origin: 50%"><ul class="root"><li><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link"><a href="sketches.html">sketches/</a></span></span></div></li></ul></li></ul></nav><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">C03_ShaderExperiment</h1><h2 id="c03_shaderexperiment">C03_ShaderExperiment</h2><p>The goal here was to get the basic shaders to work, in order to do this I had to learn a little about shaders (which I found semi non-intuitive and the documentation is poor at best).</p><h3 id="algorithm">Algorithm</h3><ul><li>Create a renderTarget with a depth and color buffer</li><li>Create your shapes and color index assignments into the palette</li><li>Each iteration<ul><li>Clear the buffer</li><li>Draw your shapes with the shader</li><li>Update your world state -draw the render target to the screen</li></ul></li></ul><p>The shader looks at each pixel matches its color against the palette, does the mod math from <span class="zettel-link-container cf"><span class="zettel-link"><a href="C01_ColorStudy_AddingIndex.html">C01_ColorStudy_AddingIndex</a></span></span> and <span class="zettel-link-container cf"><span class="zettel-link"><a href="C02_ColorStudy_2dcity.html">C02_ColorStudy_2dcity</a></span></span> and then outputs the new color to that pixel. See <a href="sketches/C01_ColorStudy_AddingIndex#The Wrapped Color Palette Math" title="cf">sketches/C01_ColorStudy_AddingIndex#The Wrapped Color Palette Math</a> for details on the color palette</p><h4 id="the-shader">The Shader</h4><p>Take the current color buffer state for the render target (the current image) as a texture. Then within that texture find where the present fragment is. After that we can modify the state by returning a new color for that fragment.</p><p><span class="zettel-link-container errors"><span class="zettel-link" title="Wiki-link does not refer to any existing zettel"><a>Shaders</a></span></span> in <span class="zettel-link-container cf"><span class="zettel-link"><a href="OpenRNDR.html">OpenRNDR</a></span></span> use a combination of <span class="zettel-link-container errors"><span class="zettel-link" title="Wiki-link does not refer to any existing zettel"><a>GLSL</a></span></span> (<span class="zettel-link-container errors"><span class="zettel-link" title="Wiki-link does not refer to any existing zettel"><a>OpenGLs</a></span></span> Shader language) and a few conventions around making fragment and vertex shaders. Vertex shaders basically determine how shape vertexes and triangles get mapped to the final displayed image. Fragment or pixel shaders, determine how the individual pixels are rendered.</p><p>To get this to work I created the following class which implements a fragment shader <code>shadeStyle</code>:</p><pre><code class="kotlin language-kotlin">open class ShaderColorPaletteModMath(
  colorBuffer: ColorBuffer,
  width: Int,
  height: Int,
  colorIdx: Int,
  palette: BasePalette
) : ShadeStyle() {

  var colorBuffer: ColorBuffer by Parameter()
  var width: Double by Parameter()
  var height: Double by Parameter()
  var colorIdx: Int by Parameter()
  var palette: Array&lt;Vector4&gt; by Parameter()

  init {
    this.colorBuffer = colorBuffer
    this.width = width.toDouble()
    this.height = height.toDouble()
    this.colorIdx = colorIdx
    this.palette = palette.toVector4Array()

    fragmentTransform = &quot;&quot;&quot;
            vec2 invSize = vec2(1/p_width, 1/p_height);
            // Reflect the axis so that the upper left hand corner is 0,0
            vec2 coord = vec2(0,1) - c_screenPosition.xy*invSize * vec2(-1,1);
			
			// Load the current screen state as a 2d texture
            vec4 c = texture2D(p_colorBuffer, coord);
			
			// find the color index represented by the current color, if it
			// is not found we will color over it unless it is black.
            int bg_idx = 0;
            for(int i = 0; i &lt; p_palette_SIZE; i++) {
              if (c.rgb == p_palette[i].rgb) {
                bg_idx = i;
                break;
              } else if (c.rgb == vec3(0.0, 0.0, 0.0)) {
                bg_idx = -1;
                break;
              }
            }
            
            if (bg_idx &gt;= 0) {
              int next_idx = (p_colorIdx + bg_idx) % p_palette_SIZE;
              x_fill.rgb = p_palette[next_idx].rgb;
            } else {
              x_fill.rgb = c.rgb;
            }
            
            // Setting the stroke alpha to 1 prevents the weird smoothing effect that was causing issues at the
            // edges
            strokeAlpha = 1.0;
            &quot;&quot;&quot;.trimMargin()
  }
}</code></pre><p>This is a shader which uses the present screen color buffer as a texture. To get the pixel lookup to line up I had to scale and reflect the cordinate position so that the upper left hand corner is (0.0, 0.0) and the bottom right hand corner is (1.0, 1.0). Once doing this this texture lookup works properly.</p><p>Afte this we search through the palette to match the present color agains the background color. This will allow us to find the next index in the palette for the current color.</p><p>At the end I set <code>strokeAlpha = 1.0</code>, which seems to prevent some weird effects at the edges of the stroke our outlines placed on colors, likely due to mixing the stroke or color into the shape.</p><p>To improve this I would use a texture that represented the indexes directly with no aliasing or anything, then rendered the colors from that using 2 different buffers. I think this would avoid all of the weird aliasing issues I have been running into, since the color boundaries would always be clearly defined.</p><h3 id="progression">Progression</h3><h4 id="trying-to-understand-how-the-shader-and-textures-work">Trying to understand how the shader and textures work</h4><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-00.56.46.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-00.56.46.png" /></p><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-01.22.28.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-01.22.28.png" /></p><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-01.41.38.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-01.41.38.png" /></p><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-08.59.45.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-08.59.45.png" /></p><h4 id="applying-a-nicer-color-palette">Applying a nicer color palette</h4><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-09.27.49.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-09.27.49.png" /></p><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-09.27.53.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-09.27.53.png" /></p><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-09.28.00.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-09.28.00.png" /></p><p><embed src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-09.44.39.mp4" autostart="false" height="300" width="100%"></embed></p><h4 id="porting-over-c02">Porting over C02</h4><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-10.19.58.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-10.19.58.png" /></p><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-10.20.02.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-10.20.02.png" /></p><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-10.30.09.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-10.30.09.png" /></p><p><embed src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-07-31-10.26.19.mp4" autostart="false" height="300" width="100%"></embed></p><p>Having some issues with outlines etc</p><h4 id="getting-rid-of-the-outlines">Getting rid of the outlines</h4><p>To get rid of the outlines simply setting the <code>strokeAlpha = 1.0</code> at the end of the shader seemed to help the most. I also had to subtract 2 pixels from the height and somewhere between 1 and 2 pixels from the width depending on the dx of the rhombus… I have not yet quite figured this out yet.</p><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-08-01-21.25.59.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-08-01-21.25.59.png" /></p><p><img alt="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-08-01-21.30.41.png" src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-08-01-21.30.41.png" /></p><p><embed src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-08-01-21.15.28.mp4" autostart="false" height="300" width="100%"></embed></p><p><embed src="static/sketches/C03_ShaderExperiments/sketch.C03_ShaderExperiment-2021-08-01-21.29.57.mp4" autostart="false" height="300" width="100%"></embed></p><h4 id="references">References</h4><ul><li><a href="https://guide.openrndr.org/#/06_Advanced_drawing/C04_Shade_styles?id=usage-examples">https://guide.openrndr.org/#/06_Advanced_drawing/C04_Shade_styles?id=usage-examples</a></li><li><a href="https://learnopengl.com/Getting-started/Textures">https://learnopengl.com/Getting-started/Textures</a></li><li><a href="https://thebookofshaders.com/11/">https://thebookofshaders.com/11/</a></li></ul><p>I had to look at the <code>ShaderError.txt</code> output a lot to get an idea of what parameters are available to me</p><p>the sampler2d is still a bit of a mystery</p><p><a href="https://medium.com/@grahamte/glsl-shaders-and-the-magic-of-graphical-rendering-ca94a578cf8b">https://medium.com/@grahamte/glsl-shaders-and-the-magic-of-graphical-rendering-ca94a578cf8b</a></p><h3 id="future-work">Future Work</h3><ul><li>Shader still has issues around the outline boundaries. Maybe don’t draw them then draw all of the outlines in bulk at the end if I want them</li></ul></div></article><nav class="ui attached segment deemphasized backlinksPane" id="neuron-backlinks-pane"><h3 class="ui header">Backlinks</h3><ul class="backlinks"><li><span class="zettel-link-container cf"><span class="zettel-link"><a href=".">Chris Woodall&#39;s Generative Art Studio</a></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><span class="zettel-link-container cf"><span class="zettel-link"><a href="C03_ShaderExperiment.html">C03_ShaderExperiment</a></span></span></div></li></ul></li></ul><h3 class="ui header"><span title="Backlinks from folgezettel parents">Uplinks</span></h3><ul class="backlinks"><li><span class="zettel-link-container folge"><span class="zettel-link"><a href="sketches.html">sketches/</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><em>Parent directory zettel</em></div></li></ul></li></ul></nav><nav class="ui attached segment deemphasized bottomPane" id="neuron-tags-pane"><div><span class="ui basic label zettel-tag" title="Tag">root/sketches</span></div></nav><nav class="ui bottom attached icon compact inverted menu red" id="neuron-nav-bar"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="item" href="https://github.com/cwoodall/generative-art-studio/edit/main/notes./sketches/C03_ShaderExperiment.md" title="Edit this page"><i class="edit icon"></i></a><a class="right item" href="impulse.html" title="Open Impulse"><i class="wave square icon"></i></a></nav></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.34.1" /></a></div></div></div></body></html>